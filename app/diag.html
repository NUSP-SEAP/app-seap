<!DOCTYPE html>

<html lang="pt-BR"><meta charset="utf-8"/><title>Diagnóstico Auth (final)</title>
<body style="font-family: ui-sans-serif, system-ui, -apple-system; padding:20px;">
<h1>Diagnóstico de Autenticação</h1>
<pre id="out" style="background:#111;color:#0f0;padding:12px;border-radius:8px;white-space:pre-wrap"></pre>
<script>
(async () => {
  const out = document.getElementById('out');
  const log = (x)=>out.textContent += (typeof x==='string'?x:JSON.stringify(x,null,2)) + "\\n";
  const token = localStorage.getItem('auth_token') || '';
  log("Token no localStorage:"); log(token || "(vazio)");
  log("\\nChamando whoami direto...");
  try {
    const r = await fetch('https://n8n.senado-nusp.cloud/webhook/whoami?ts='+Date.now(), {
      method: 'GET',
      headers: {
        'Authorization': token ? ('Bearer ' + token) : '',
        'Cache-Control':'no-cache, no-store, must-revalidate',
        'Pragma':'no-cache','Expires':'0',
        'If-None-Match':'\"0\"','If-Modified-Since':'0'
      },
      cache: 'reload'
    });
    log("Status: " + r.status);
    const text = await r.text();
    log("Body:"); log(text);
  } catch(e) {
    log("Erro fetch whoami: " + (e && e.message));
  }
})();
</script>
<script src="/js/auth_jwt.js"></script>  <script src="/js/session-autoload.js"></script>
</body></html>
